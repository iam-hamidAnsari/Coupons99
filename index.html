<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Coupon99.com</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="png/logo-no-background.png" alt="Logo" style="max-height: 60px; width: auto;"
                    class="d-inline-block align-top">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#couponModal">Add Coupon</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="About.html">About Us</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Contact.html">Contact us</a>
                    </li>
                </ul>
                <input class="form-control me-2" type="search" placeholder="search coupons using name & keyword"
                    id="searchInput" aria-label="Search">
                <div class="navbar-nav">
                    <div class="user-icon">
                        <i class="fas fa-user-circle"></i>
                        <div class="hover-content">
                            <div class="welcome-note">
                                <i class="fas fa-shopping-bag"></i>
                                <p>Welcome to <strong>Coupons99.com</strong>. Earn extra cashback on top of other
                                    discounts on your shopping via Coupons99.com</p>
                            </div>
                            <div class="login-signup-buttons">
                                <a href="#" data-bs-toggle="modal" data-bs-target="#loginModal"
                                    class="btn-login">Login</a>
                                <a href="#" data-bs-toggle="modal" data-bs-target="#modal-Signup"
                                    class="btn-signup">Sign Up</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Coupon Submission Modal -->
    <div class="modal fade" id="couponModal" tabindex="-1" aria-labelledby="couponModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="couponModalLabel">Add Coupon</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="Addcoupon">
                        <div class="mb-3">
                            <label for="title" class="form-label">Coupon Title:</label>
                            <input type="text" class="form-control" id="title" name="title" required>
                        </div>
                        <div class="mb-3">
                            <label for="code" class="form-label">Coupon Code:</label>
                            <input type="text" class="form-control" id="code" name="code" required>
                        </div>

                        <div class="mb-3">
                            <label for="image" class="form-label">Coupon Image:</label>
                            <input type="file" class="form-control" id="image" name="image" accept="image/*">
                        </div>
                        <div class="mb-3">
                            <label for="price" class="form-label">Coupon Price:</label>
                            <input type="price" class="form-control" id="price" name="price" required>
                        </div>

                        <div class="mb-3">
                            <label for="description" class="form-label">Description:</label>
                            <textarea class="form-control" id="description" name="description" required></textarea>
                        </div>

                        <div class="mb-3">
                            <label for="category" class="form-label">Category:</label>
                            <select class="form-select" id="category" name="category"
                                onchange="toggleCustomCategory(this)">
                                <option value="shopping">Shopping</option>
                                <option value="dining">Dining</option>
                                <option value="travel">Travel</option>
                                <option value="others">Others</option>
                            </select>
                        </div>
                        <div class="mb-3" id="customCategory" style="display:none;">
                            <label for="customCategoryInput" class="form-label">Please specify:</label>
                            <input type="text" class="form-control" id="customCategoryInput" name="customCategory">
                        </div>
                        <div class="mb-3">
                            <label for="expiry" class="form-label">Expiry Date:</label>
                            <input type="date" class="form-control" id="expiry" name="expiry" required>
                        </div>

                        <div class="mb-3">
                            <label for="discount" class="form-label">Discount Percentage:</label>
                            <input type="number" class="form-control" id="discount" name="discount" min="0" max="100"
                                step="1" required>
                        </div>

                        <div class="mb-3">
                            <label for="terms" class="form-label">Terms and Conditions:</label>
                            <textarea class="form-control" id="terms" name="terms" required></textarea>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary">Submit Coupon</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Inside the Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="loginModalLabel">Coupon99</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h2 class="text-center">Login</h2>
                    <form id="login-form">
                        <!-- Input fields for username and password -->
                        <div class="mb-3">
                            <label for="login-username" class="form-label">Username:</label>
                            <input type="text" class="form-control" id="login-username" name="login-username"
                                autocomplete="username" required>
                        </div>
                        <div class="mb-3">
                            <label for="login-password" class="form-label">Password:</label>
                            <input type="password" class="form-control" id="login-password" name="login-password"
                                autocomplete="current-password" required>
                        </div>
                        <div class="mb-3 text-center">
                            <button type="submit" id="login-btn" class="btn btn-primary">Login</button>
                        </div>
                    </form>
                    <div class="modal-footer">
                        <p class="text-center">Don't have an account? <a href="#" data-bs-toggle="modal"
                                data-bs-target="#modal-Signup">Register here</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Inside the Registration Modal -->
    <div class="modal fade" id="modal-Signup" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="loginModalLabel">Coupon99</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Registration Form -->
                    <div class="container">
                        <h2 class="text-center">Register</h2>
                        <form id="registration-form">
                            <div class="mb-3">
                                <label for="reg-username" class="form-label">Username:</label>
                                <input type="text" class="form-control" id="reg-username" name="reg-username"
                                    autocomplete="username" required>
                            </div>
                            <div class="mb-3">
                                <label for="reg-password" class="form-label">Password:</label>
                                <input type="password" class="form-control" id="reg-password" name="reg-password"
                                    autocomplete="new-password" required>
                            </div>
                            <div class="mb-3">
                                <label for="reg-email" class="form-label">Email:</label>
                                <input type="email" class="form-control" id="email" name="reg-email" required>
                            </div>
                            <div class="mb-3">
                                <label for="reg-number" class="form-label">Mobile No:</label>
                                <input type="text" class="form-control" id="number" name="reg-number"
                                    pattern="\+[0-9]{10,15}" required
                                    title="Mobile number should start with a + and include country code followed by 9 to 14 digits.">
                            </div>
                            <div class="mb-3 text-center">
                                <button type="submit" id="signup-btn" class="btn btn-primary">Register</button>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <p class="text-center">Already have an account? <a href="#" data-bs-toggle="modal"
                                data-bs-target="#loginModal">Login here</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- slide ad -->
    <div id="carouselExampleCaptions" class="carousel slide carousel-fade" data-bs-ride="false" style="margin-top: 3%;">
        <div class="carousel-indicators">
            <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="0" class="active"
                aria-current="true" aria-label="Slide 1"></button>
            <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="1"
                aria-label="Slide 2"></button>
            <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="2"
                aria-label="Slide 3"></button>
        </div>
        <div class="carousel-inner container">
            <div class="carousel-item active">
                <img src="https://d3pzq99hz695o4.cloudfront.net/sitespecific/in/banner/web/beea2a9b535f990cec3da4274865a271/banner_home-580x1160.webp?329428"
                    class="d-block w-100" alt="...">
            </div>
            <div class="carousel-item">
                <img src="https://d3pzq99hz695o4.cloudfront.net/sitespecific/in/banner/web/d5340041be659e4ba9971acc50d7b69a/banner_home-580x1160.webp?259104"
                    class="d-block w-100" alt="...">
                <div class="carousel-caption d-none d-md-block">
                </div>
            </div>
            <div class="carousel-item">
                <img src="https://d3pzq99hz695o4.cloudfront.net/sitespecific/in/banner/web/b2aa8487bedc8c4dc6058dbbbe8ce84b/banner_home-580x1160.webp?691041"
                    class="d-block w-100" alt="...">
            </div>
        </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </button>
    </div>

    <!-- steps to buy coupon -->
    <div class="container my-5">
        <h2 class="text-center mb-4">Three Steps To Save With Coupons99.com</h2>
        <div class="row">
            <div class="col-md-4 step">
                <div class="step-icon">
                    <i class="fas fa-search"></i>
                    <!-- <span class="right-arrow-icon"><i class="fas fa-arrow-right"></i></span> -->
                </div>
                <h3>Find Best Coupon and Offer</h3>
                <p>Click to explore and find the best coupon and offer.</p>
            </div>
            <div class="col-md-4 step">
                <div class="step-icon">
                    <i class="fas fa-tags"></i>
                    <!-- <span class="right-arrow-icon"><i class="fas fa-arrow-right"></i></span> -->
                </div>
                <h3>Click to Buy Now</h3>
                <p>Click on the coupon to buy now and avail the discount.</p>
            </div>
            <div class="col-md-4 step">
                <div class="step-icon">
                    <i class="fas fa-credit-card"></i>
                </div>
                <h3>Pay for the Coupon and Save</h3>
                <p>Proceed to payment and save money with Coupons99.com.</p>
            </div>
        </div>
    </div>

    <!-- Coupon content -->
    <div class="coupons-heading">
        <h2><b>Coupons</b></h2>
    </div>
    <br>
    <div id="coupons-container">
        <!-- Example coupon item -->
        <div class="coupon">
            <h3>Coupon Title</h3>
            <img src="coupon-image.jpg" alt="Coupon Image">
            <p>Description of the coupon.</p>
            <button class="action-button" onclick="redeemCoupon()">Redeem</button>
        </div>
    </div>

    <!-- footer -->
    <footer>
        <div>© 2024 Coupon99.com. All rights reserved.</div>
        <div>Follow us on
            <a href="https://www.linkedin.com/in/hamid-ansari-303b35263/" class="text-white"><i
                    class="fab fa-linkedin"></i></a>
              <a href="https://github.com/iam-hamidAnsari" class="text-white"><i class="fab fa-github"></i></a>
              <a href="https://www.instagram.com/iam_hamidansari" class="text-white"><i class="fab fa-instagram"></i></a>
        </div>
        <div>Devloped By Hamid Ansari</div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>
    <!-- Service -->
    <script>
        function toggleCustomCategory(select) {
            var customCategoryDiv = document.getElementById('customCategory');
            if (select.value === 'others') {
                customCategoryDiv.style.display = 'block';
            } else {
                customCategoryDiv.style.display = 'none';
            }
        }
    </script>
    <!-- service for user icon -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var userIcon = document.querySelector('.user-icon');
            userIcon.addEventListener('click', function () {
                var hoverContent = this.querySelector('.hover-content');
                var isDisplayed = window.getComputedStyle(hoverContent).display !== 'none';
                hoverContent.style.display = isDisplayed ? 'none' : 'block';
            });
        });
    </script>

    <!-- Fetching All Coupons -->
    <script>
        // JavaScript for appending coupons remains the same
        // Example function to handle the action button click event
        function redeemCoupon(coupon) {
            // Now you can do something with the coupon object, such as:
            // alert("Coupon redeemed successfully! Title: " + coupon.couponTitle);
            // Log coupon details to the console as an example
            console.log(coupon);
            // Redirect to the next page URL
            window.location.href = 'Data.html?couponId=' + coupon.id; // Assuming each coupon has an 'id' property
        }

        $(document).ready(function () {
            $.ajax({
                url: "data.json",
                type: "GET",
                success: function (coupons) {
                    var container = $('#coupons-container');
                    container.empty(); // Clear previous content

                    coupons.forEach(function (coupon) {
                        var div = $('<div>').addClass('coupon');

                        var title = $('<h3>').text(coupon.couponTitle);
                        div.append(title);

                        if (coupon.imageUrl) {
                            var img = $('<img>').attr("src", "coupon99/CouponImages/" + coupon.imageUrl);
                            div.append(img);
                        }

                        var price = $('<h3>').text("₹" + coupon.price);
                        div.append(price);

                        var description = $('<p>').text(coupon.description);
                        div.append(description);

                        var actionButton = $('<button>')
                        var actionButton = $('<button>')
                            .addClass('action-button get-coupon-button') // Use the new class
                            .text('Get this Coupon')
                            .on('click', (function (couponCopy) {
                                return function () {
                                    redeemCoupon(couponCopy);
                                }
                            })(coupon));


                        div.append(actionButton);
                        container.append(div);
                    });
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.error("Error loading coupons: ", textStatus, errorThrown);
                    // Optionally, display an error message to the user
                }
            });
        });


    </script>
    <script>

    </script>
    <!-- Connecting Add COupon -->
    <script>
        $("#Addcoupon").submit(function (event) {
            event.preventDefault();

            // Create a FormData object and append the form data
            var formData = new FormData();
            formData.append("couponTitle", $("#title").val());
            formData.append("couponCode", $("#code").val());
            // Append the file associated with the 'image' input. Assumes single file upload.
            formData.append("imageUrl", $("#image")[0].files[0]);
            formData.append("price", $("#price").val());
            formData.append("description", $("#description").val());
            formData.append("category", $("#category").val());
            formData.append("expiryDate", $("#expiry").val());
            formData.append("percentage", $("#discount").val());
            formData.append("terms", $("#terms").val());

            $.ajax({
                url: "http://localhost:8080/AddCoupon",
                type: "POST",
                processData: false, // Important: Do not process data
                contentType: false, // Important: Do not set a content type
                data: formData,
                success: function (response) {
                    alert("Coupon Added Successfully");
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert("Something went wrong");
                    console.log(jqXHR, textStatus, errorThrown);
                }
            });
        });
    </script>
    <!-- Connecting Registration Form -->
    <script>
        $("#registration-form").submit(function (event) {
            event.preventDefault();
            var usersData = {
                "username": $("#reg-username").val(),
                "password": $("#reg-password").val(),
                "email": $("#email").val(),
                "number": $("#number").val()
            };
            $.ajax({
                url: "http://localhost:8080/Register",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify(usersData),
                success: function (response2) {
                    if (response2 == true) {
                        alert("Registerd Successfully");
                    }
                    else {
                        alert("Something went wrong");
                        console.log(response2);
                        console.log(usersData);
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log(jqXHR, textStatus, errorThrown);

                }
            });

        })
    </script>
    <!-- Login page -->
    <script>
        $("#login-form").submit(function (event) {
            event.preventDefault();
            var username = $("#login-username").val();
            var password = $("#login-password").val();
            $.ajax({
                url: "http://localhost:8080/Login?username=" + username,
                type: "POST",
                success: function (response3) {
                    if (response3 != null) {
                        if (password == response3.password) {
                            alert("Welcome " + response3.username);
                            // $(".welcome").html("Welcome " + response3.Firstname);
                            // data = "heres your data  " + " First Name : " + response.Firstname + " Last name : " + response.Lastname + " Contact no : " + response.number + " Email : " + response.email + " Gender :" + response.gender;
                            // $(".result").html(data);

                        } else {
                            alert("Invalid Password");
                            // console.log(response3);
                        }
                    }
                    else {
                        alert("Invalid Password Or username");

                    }
                },
                error: function (j, t, err) {
                    alert("Please Register First");
                    console.log(err, j, t);

                }
            });
        })
    </script>
    <!-- Search Coupons -->
    <script>
        $("#searchInput").on('input', function (event) { // Changed the event to 'input' for instant feedback or use 'change' to trigger when the input field loses focus
            event.preventDefault();
            var query = $("#searchInput").val();

            $.ajax({
                url: "http://localhost:8080/Search?query=" + query, // Fixed concatenation here
                type: "GET",
                success: function (response4) { // Changed 'response' to 'response4' here
                    var container = $('#coupons-container');
                    container.empty(); // Clear previous content

                    response4.forEach(function (coupon) { // Changed to 'response4' here
                        var div = $('<div>').addClass('coupon');

                        var title = $('<h3>').text(coupon.couponTitle);
                        div.append(title);

                        if (coupon.imageUrl) {
                            var img = $('<img>').attr("src", "coupon99/CouponImages/" + coupon.imageUrl);
                            div.append(img);
                        }


                        var price = $('<h3>').text("₹" + coupon.price);
                        div.append(price);

                        var description = $('<p>').text(coupon.description);
                        div.append(description);

                        var actionButton = $('<button>')
                        var actionButton = $('<button>')
                            .addClass('action-button get-coupon-button') // Use the new class
                            .text('Get this Coupon')
                            .on('click', (function (couponCopy) {
                                return function () {
                                    redeemCoupon(couponCopy);
                                }
                            })(coupon));


                        div.append(actionButton);
                        container.append(div);
                    });
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.error("Error loading coupons: ", textStatus, errorThrown);
                    // Optionally, display an error message to the user
                }
            });
        });
    </script>

    <!-- Coupon Page -->
    <script>

    </script>


</body>

</html>